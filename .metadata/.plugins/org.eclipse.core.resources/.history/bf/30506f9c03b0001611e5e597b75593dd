package crawlData;

import java.util.ArrayList;

import org.jsoup.Jsoup;
import org.jsoup.nodes.Document;
import org.jsoup.nodes.Element;
import org.jsoup.select.Elements;

public class CrawlDanTri {

	/*
	 * Danh sách các link chủ đề
	 */
	public ArrayList<String> addUrl() {
		ArrayList<String> URLs = new ArrayList<String>();
		URLs.add("http://dantri.com.vn/the-gioi.htm");
//		URLs.add("http://dantri.com.vn/suc-khoe.htm");
//		URLs.add("http://dantri.com.vn/kinh-doanh.htm");
//		URLs.add("http://dantri.com.vn/the-thao.htm");
//		URLs.add("http://dantri.com.vn/suc-manh-so/dien-thoai.htm");
		return URLs;
	}
	
	/*
	 * 
	 * Lấy tất cả các link tin tức trong link chủ đề
	 * 
	 * Output: biến trả ra danh sách các link tin tức thuộc chủ đề
	 * 
	 */
	public ArrayList<String> getLinksDanTri() {
		ArrayList<String> URLs = addUrl();
		ArrayList<String> link = new ArrayList<String>();
		for (String url : URLs) {
			try {
				// Lay het noi dung HTML cua trang co URL = currentURL
				Document doc = Jsoup.connect(url).data("query", "Java").userAgent("Mozilla").cookie("auth", "token")
						.timeout(50000).get();

				// Lay cac element la div trong doc
				Elements forms = doc.getElementsByTag("form");
				// Duyệt qua từng element
				for (Element form : forms) {
					if(form.attr("name").trim().equals("aspnetForm")){
						Elements aspnetForms = form.children();
						for(Element aspnetForm : aspnetForms){
							if(aspnetForm.attr("class").trim().equals("wrapper") && aspnetForm.tagName().trim().equals("div")){
								Elements wrappers = aspnetForm.children();
								for(Element wrapper : wrappers){
									if(wrapper.attr("class").trim().equals("container") && wrapper.tagName().trim().equals("div")){
										Elements containers = wrapper.children();
										for(Element container : containers){
											if(container.attr("class").trim().equals("clearfix") && container.tagName().trim().equals("div")){
												Elements clearfixs = container.children();
												for(Element clearfix : clearfixs){
													if(clearfix.attr("class").trim().equals("fl wid470") && clearfix.tagName().trim().equals("div")){
														Elements wid470s = clearfix.children();
														for(Element wid470 : wid470s){
															//Lấy link trong div class mt3 clearfix
															if(wid470.attr("class").trim().equals("mt3 clearfix") && wid470.tagName().equals("div")){
																Elements mt3s = wid470.children();
																for(Element mt3 : mt3s){
																	//Lấy link trong thẻ a
																	if(mt3.tagName().trim().equals("a")){
																		link.add("http://dantri.com.vn" + mt3.attr("href"));
																	}
																	//Lấy link trong thẻ mr1
																	if(mt3.attr("class").trim().equals("mr1") && mt3.tagName().trim().equals("div")){
																		Elements mr1s = mt3.children();
																		for(Element mr1 : mr1s){
																			if(mr1.attr("class").trim().equals("fon5 wid255 fl") && mr1.tagName().trim().equals("div")){
																				Elements wid255s = mr1.children();
																				for(Element wid255 : wid255s){
																					if(wid255.tagName().trim().equals("a")){
																						link.add("http://dantri.com.vn" + wid255.attr("href"));
																					}
																				}
																			}
																		}
																	}
																}
															}
															//Lấy link trong div class clearfix
															if(wid470.attr("class").trim().equals("clearfix") && wid470.tagName().equals("div")){
																Elements clearfixs1 = wid470.children();
																for(Element clearfix1: clearfixs1){
																	if(clearfix1.attr("class").trim().equals("mt3 clearfix") && clearfix1.tagName().trim().equals("div")){
																		Elements mt3s = clearfix1.children();
																		for(Element mt3 : mt3s){
																			//Lấy link trong a
																			if(mt3.tagName().trim().equals("a")){
																				link.add("http://dantri.com.vn" + mt3.attr("href"));
																			}
																			//Lấy link trong thẻ mr1
																			if(mt3.attr("class").trim().equals("mr1") && mt3.tagName().trim().equals("div")){
																				Elements mr1s = mt3.children();
																				for(Element mr1 : mr1s){
																					if(mr1.attr("class").trim().equals("fon5 wid324 fl") && mr1.tagName().trim().equals("div")){
																						Elements wid324s = mr1.children();
																						for(Element wid324 : wid324s){
																							if(wid324.tagName().trim().equals("a")){
																								link.add("http://dantri.com.vn" + wid324.attr("href"));
																							}
																						}
																					}
																				}
																			}
																		}
																	}
																}
															}
														}
													}
												}
											}
										}
									}
								}
							}
						}
					}
				}
			} catch (Exception e) {
				e.printStackTrace();
			}
		}
		//Loại bỏ những link trùng nhau
		for(int i = 0; i < link.size(); i++){
			int j = i + 1;
			while(j < link.size()){
				if(link.get(i).equals(link.get(j))){
					link.remove(j);
				}
				j++;
			}
		}
		return link;
	}
}
